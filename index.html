<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ–º–µ–π–Ω—ã–π –ë—é–¥–∂–µ—Ç ¬∑ –†–∏—Å–∫ –∏ –ü—Ä–∏–±—ã–ª—å</title>
    <style>
        /* ========== –°–¢–ò–õ–ò ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Inter', -apple-system, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.5;
            padding: 20px;
        }

        #app {
            max-width: 1280px;
            margin: 0 auto;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .container {
            background: white;
            border-radius: 32px;
            box-shadow: 0 20px 40px -15px rgba(0,0,0,0.1);
            padding: 3rem;
            text-align: center;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -2px rgba(0,0,0,0.05);
            margin: 0.5rem;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #1e293b;
        }

        .btn-outline {
            background: white;
            border: 2px solid #e2e8f0;
            color: #1e293b;
        }

        .btn-outline:hover {
            border-color: #2563eb;
            background: #f8fafc;
        }

        /* –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é */
        .game-title {
            font-size: 3rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.5rem;
        }

        .game-subtitle {
            font-size: 1.25rem;
            color: #475569;
            margin-bottom: 2.5rem;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 320px;
            margin: 0 auto;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-form {
            max-width: 400px;
            margin: 2rem auto;
            text-align: left;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #334155;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
        }

        /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 1.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
        }

        .round-info {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .round-value {
            font-size: 2rem;
            font-weight: 700;
            color: #0f172a;
        }

        .net-worth-card {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: white;
            padding: 1.25rem;
            border-radius: 16px;
            box-shadow: 0 4px 6px -2px rgba(0,0,0,0.03);
        }

        .stat-label {
            font-size: 0.875rem;
            color: #64748b;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
        }

        .game-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .budget-panel, .event-card {
            background: white;
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 4px 6px -2px rgba(0,0,0,0.03);
        }

        .budget-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .budget-row input[type="range"] {
            width: 120px;
        }

        .phase-indicator {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .phase {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            background: #f1f5f9;
            border-radius: 12px;
            color: #64748b;
        }

        .phase.active {
            background: #2563eb;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 32px;
            max-width: 500px;
            width: 90%;
        }

        .event-value.positive { color: #059669; }
        .event-value.negative { color: #dc2626; }

        .final-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .final-stat-card {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 20px;
        }

        @media (max-width: 768px) {
            .game-grid { grid-template-columns: 1fr; }
            .container { padding: 1.5rem; }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ========== –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ========== -->
        <div id="main-menu" class="screen active">
            <div class="container">
                <h1 class="game-title">üí∞ –°–µ–º–µ–π–Ω—ã–π –ë—é–¥–∂–µ—Ç</h1>
                <p class="game-subtitle">–†–∏—Å–∫ –∏ –ü—Ä–∏–±—ã–ª—å</p>
                <div class="menu-buttons">
                    <button id="new-game-btn" class="btn btn-primary">üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button id="continue-game-btn" class="btn btn-secondary">‚èØ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                    <button id="rules-btn" class="btn btn-outline">üìñ –ü—Ä–∞–≤–∏–ª–∞</button>
                    <button id="settings-btn" class="btn btn-outline">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </div>
            </div>
        </div>

        <!-- ========== –ù–ê–°–¢–†–û–ô–ö–ò ========== -->
        <div id="settings-screen" class="screen">
            <div class="container">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h2>
                <div class="settings-form">
                    <div class="form-group">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (1‚Äì6)</label>
                        <input type="number" id="players-count" min="1" max="6" value="2">
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ (4‚Äì16)</label>
                        <input type="number" id="rounds-count" min="4" max="16" value="12">
                    </div>
                    <div class="form-group">
                        <label>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</label>
                        <select id="difficulty-level">
                            <option value="easy">üå± –õ—ë–≥–∫–∏–π</option>
                            <option value="medium" selected>‚öñÔ∏è –°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="hard">üî• –°–ª–æ–∂–Ω—ã–π</option>
                        </select>
                    </div>
                    <div class="settings-actions">
                        <button id="save-settings-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button id="back-to-menu-btn" class="btn btn-outline">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== –ü–†–ê–í–ò–õ–ê ========== -->
        <div id="rules-screen" class="screen">
            <div class="container">
                <h2>üìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
                <div style="text-align: left; margin: 2rem 0;">
                    <h3>–¶–µ–ª—å –∏–≥—Ä—ã</h3>
                    <p>–£–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ–º–µ–π–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º, –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π.</p>
                    
                    <h3 style="margin-top: 1.5rem;">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h3>
                    <ul style="margin-left: 1.5rem;">
                        <li>–ö–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥ = 1 –º–µ—Å—è—Ü</li>
                        <li>–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ 5 —Ñ–∞–∑: –î–æ—Ö–æ–¥—ã ‚Üí –†–∞—Å—Ö–æ–¥—ã ‚Üí –°–æ–±—ã—Ç–∏–µ ‚Üí –†–µ—à–µ–Ω–∏–µ ‚Üí –ò—Ç–æ–≥</li>
                        <li>–†–µ–≥—É–ª–∏—Ä—É–π—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã —Å–ª–∞–π–¥–µ—Ä–∞–º–∏</li>
                        <li>–ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ —Å–æ–±—ã—Ç–∏—è–º</li>
                        <li>–ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏ –±–µ—Ä–∏—Ç–µ –∫—Ä–µ–¥–∏—Ç—ã</li>
                    </ul>
                </div>
                <button id="back-from-rules" class="btn btn-outline">–í –º–µ–Ω—é</button>
            </div>
        </div>

        <!-- ========== –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù ========== -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="round-info">
                    <span class="round-label">–ú–µ—Å—è—Ü</span>
                    <span class="round-value" id="current-round">1</span>
                    <span id="max-rounds">/12</span>
                </div>
                <div class="net-worth-card">
                    <span>üí∞ –ß–∏—Å—Ç–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</span>
                    <span style="font-size: 1.75rem; font-weight: 700;" id="net-worth">5 000 ‚Ç∏</span>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-panel">
                <div class="stat-item">
                    <span class="stat-label">üíµ –î–µ–Ω—å–≥–∏</span>
                    <span class="stat-value" id="stat-money">5 000</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">üè¶ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</span>
                    <span class="stat-value" id="stat-savings">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</span>
                    <span class="stat-value" id="stat-investments">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">üí≥ –î–æ–ª–≥–∏</span>
                    <span class="stat-value" id="stat-debts">0</span>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ -->
            <div class="game-grid">
                <!-- –ë—é–¥–∂–µ—Ç -->
                <div class="budget-panel">
                    <h3>üìä –ë—é–¥–∂–µ—Ç –º–µ—Å—è—Ü–∞</h3>
                    <div id="budget-categories"></div>
                    <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid #e2e8f0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>–î–æ—Ö–æ–¥:</span>
                            <span id="total-income">9 200 ‚Ç∏</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>–†–∞—Å—Ö–æ–¥—ã:</span>
                            <span id="total-expenses">6 300 ‚Ç∏</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: 700; color: #2563eb;">
                            <span>–ë–∞–ª–∞–Ω—Å:</span>
                            <span id="balance">2 900 ‚Ç∏</span>
                        </div>
                    </div>
                </div>

                <!-- –°–æ–±—ã—Ç–∏–µ -->
                <div class="event-card" id="event-card">
                    <div style="background: #fef3c7; color: #92400e; display: inline-block; padding: 0.25rem 1rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600; margin-bottom: 1rem;">
                        üìå –°–û–ë–´–¢–ò–ï
                    </div>
                    <h4 id="event-title" style="font-size: 1.25rem; margin-bottom: 0.5rem;">–ó–∞–≥—Ä—É–∑–∫–∞...</h4>
                    <p id="event-description" style="color: #64748b; margin-bottom: 1rem;"></p>
                    <div id="event-value" style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;"></div>
                    <div id="event-actions"></div>
                </div>
            </div>

            <!-- –§–∞–∑—ã -->
            <div style="background: white; padding: 1.5rem; border-radius: 20px; margin: 1.5rem 0;">
                <div class="phase-indicator">
                    <div class="phase active" id="phase-income">üí∞ –î–æ—Ö–æ–¥—ã</div>
                    <div class="phase" id="phase-expenses">üìâ –†–∞—Å—Ö–æ–¥—ã</div>
                    <div class="phase" id="phase-event">üé≤ –°–æ–±—ã—Ç–∏–µ</div>
                    <div class="phase" id="phase-decision">ü§î –†–µ—à–µ–Ω–∏–µ</div>
                    <div class="phase" id="phase-result">üìä –ò—Ç–æ–≥</div>
                </div>
                <div id="phase-content" style="padding: 1rem 0;">
                    <h4>üí∞ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∞</h4>
                    <p>–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ—Ö–æ–¥: 9 200 ‚Ç∏</p>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button id="next-phase-btn" class="btn btn-primary">–°–ª–µ–¥—É—é—â–∞—è —Ñ–∞–∑–∞ ‚Üí</button>
                <button id="save-game-btn" class="btn btn-outline">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="menu-from-game-btn" class="btn btn-outline">–ú–µ–Ω—é</button>
            </div>
        </div>

        <!-- ========== –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù ========== -->
        <div id="final-screen" class="screen">
            <div class="container">
                <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">üèÜ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
                <div class="final-stats">
                    <div class="final-stat-card">
                        <span style="color: #64748b;">–ß–∏—Å—Ç–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</span>
                        <span style="font-size: 1.75rem; font-weight: 700; display: block;" id="final-networth">0 ‚Ç∏</span>
                    </div>
                    <div class="final-stat-card">
                        <span style="color: #64748b;">–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ü–µ–ª–µ–π</span>
                        <span style="font-size: 1.75rem; font-weight: 700; display: block;" id="final-goals">0/4</span>
                    </div>
                    <div class="final-stat-card">
                        <span style="color: #64748b;">–†–µ–π—Ç–∏–Ω–≥</span>
                        <span style="font-size: 1.75rem; font-weight: 700; display: block;" id="final-rating">B</span>
                    </div>
                </div>
                <div style="margin-top: 2rem;">
                    <button id="new-game-final" class="btn btn-primary">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button id="export-pdf" class="btn btn-outline">üìÑ –≠–∫—Å–ø–æ—Ä—Ç</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== –î–ê–ù–ù–´–ï ==========
        const INITIAL_PLAYER = {
            money: 5000,
            savings: 0,
            debts: 0,
            investments: 0,
            income: 9200,
            expenses: {
                housing: 2300,
                food: 1800,
                transport: 700,
                utilities: 800,
                education: 900,
                healthcare: 400,
                entertainment: 600,
                savings: 1000,
                debtPayment: 0
            },
            satisfaction: 50,
            netWorthHistory: [5000],
            goals: {
                home: { current: 0, target: 30000, completed: false },
                vacation: { current: 0, target: 15000, completed: false },
                education: { current: 0, target: 20000, completed: false },
                emergency: { current: 0, target: 15000, completed: false }
            }
        };

        const EVENT_DECK = [
            { type: 'expense', value: -6000, text: 'üîß –†–µ–º–æ–Ω—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—è', description: '–ü–æ–ª–æ–º–∫–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è ‚Äî —Å—Ä–æ—á–Ω—ã–π —Ä–µ–º–æ–Ω—Ç' },
            { type: 'expense', value: -4500, text: 'üè• –õ–µ–∫–∞—Ä—Å—Ç–≤–∞', description: '–°–µ–∑–æ–Ω–Ω–∞—è –ø—Ä–æ—Å—Ç—É–¥–∞, –Ω—É–∂–Ω—ã –ª–µ–∫–∞—Ä—Å—Ç–≤–∞' },
            { type: 'income', value: 8000, text: 'üíº –ö–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –ø—Ä–µ–º–∏—è', description: '–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ—Ç–º–µ—Ç–∏–ª–æ –≤–∞—à—É —Ä–∞–±–æ—Ç—É' },
            { type: 'income', value: 5000, text: 'üéÅ –ü–æ–¥–∞—Ä–æ–∫', description: '–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥' },
            { type: 'expense', value: -3500, text: '‚ùÑÔ∏è –ü—Ä–æ—Ä–≤–∞–ª–æ —Ç—Ä—É–±—É', description: '–ö–æ–º–º—É–Ω–∞–ª—å–Ω–∞—è –∞–≤–∞—Ä–∏—è' },
            { type: 'opportunity', value: -10000, text: 'üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è', description: '–î—Ä—É–≥ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–æ–π—Ç–∏ –≤ –±–∏–∑–Ω–µ—Å' },
            { type: 'crisis', value: -0.2, text: '‚ö° –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ', description: '–î–æ—Ö–æ–¥ –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–Ω–∏–∂–µ–Ω –Ω–∞ 20%' },
            { type: 'income', value: 3000, text: 'üñ• –§—Ä–∏–ª–∞–Ω—Å', description: '–í—ã–ø–æ–ª–Ω–∏–ª–∏ –∑–∞–∫–∞–∑ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ' }
        ];

        // ========== –û–°–ù–û–í–ù–û–ô –ö–õ–ê–°–° –ò–ì–†–´ ==========
        class FamilyBudgetGame {
            constructor() {
                this.player = JSON.parse(JSON.stringify(INITIAL_PLAYER));
                this.settings = {
                    playersCount: 2,
                    roundsCount: 12,
                    difficulty: 'medium'
                };
                this.currentRound = 1;
                this.currentPhase = 'income';
                this.currentEvent = null;
                
                this.init();
            }

            init() {
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                this.initEventListeners();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                this.updateUI();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                this.showScreen('main-menu');
            }

            initEventListeners() {
                // –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
                document.getElementById('new-game-btn').onclick = () => this.startNewGame();
                document.getElementById('continue-game-btn').onclick = () => this.loadGame();
                document.getElementById('rules-btn').onclick = () => this.showScreen('rules-screen');
                document.getElementById('settings-btn').onclick = () => this.showScreen('settings-screen');
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                document.getElementById('save-settings-btn').onclick = () => this.saveSettings();
                document.getElementById('back-to-menu-btn').onclick = () => this.showScreen('main-menu');
                document.getElementById('back-from-rules').onclick = () => this.showScreen('main-menu');
                
                // –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω
                document.getElementById('next-phase-btn').onclick = () => this.nextPhase();
                document.getElementById('save-game-btn').onclick = () => this.saveGame();
                document.getElementById('menu-from-game-btn').onclick = () => this.showScreen('main-menu');
                
                // –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
                document.getElementById('new-game-final').onclick = () => this.startNewGame();
                document.getElementById('export-pdf').onclick = () => alert('üìÑ –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                if (!localStorage.getItem('familyBudgetSave')) {
                    document.getElementById('continue-game-btn').style.display = 'none';
                }
            }

            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
            }

            startNewGame() {
                this.player = JSON.parse(JSON.stringify(INITIAL_PLAYER));
                this.currentRound = 1;
                this.currentPhase = 'income';
                
                document.getElementById('max-rounds').textContent = `/${this.settings.roundsCount}`;
                
                this.updateUI();
                this.updateBudgetTable();
                this.updatePhase('income');
                
                this.showScreen('game-screen');
            }

            updateUI() {
                document.getElementById('stat-money').textContent = `${Math.round(this.player.money).toLocaleString()} ‚Ç∏`;
                document.getElementById('stat-savings').textContent = `${Math.round(this.player.savings).toLocaleString()} ‚Ç∏`;
                document.getElementById('stat-investments').textContent = `${Math.round(this.player.investments).toLocaleString()} ‚Ç∏`;
                document.getElementById('stat-debts').textContent = `${Math.round(this.player.debts).toLocaleString()} ‚Ç∏`;
                document.getElementById('net-worth').textContent = `${Math.round(this.calculateNetWorth()).toLocaleString()} ‚Ç∏`;
                document.getElementById('current-round').textContent = this.currentRound;
            }

            calculateNetWorth() {
                return this.player.money + this.player.savings + this.player.investments - this.player.debts;
            }

            updateBudgetTable() {
                const container = document.getElementById('budget-categories');
                let html = '';
                let totalExpenses = 0;
                
                const categories = [
                    { key: 'housing', name: 'üè† –ñ–∏–ª—å—ë', value: this.player.expenses.housing },
                    { key: 'food', name: 'üçé –ï–¥–∞', value: this.player.expenses.food },
                    { key: 'transport', name: 'üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', value: this.player.expenses.transport },
                    { key: 'utilities', name: 'üí° –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ', value: this.player.expenses.utilities },
                    { key: 'education', name: 'üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', value: this.player.expenses.education },
                    { key: 'healthcare', name: '‚öïÔ∏è –ú–µ–¥–∏—Ü–∏–Ω–∞', value: this.player.expenses.healthcare },
                    { key: 'entertainment', name: 'üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', value: this.player.expenses.entertainment },
                    { key: 'savings', name: 'üí∞ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è', value: this.player.expenses.savings },
                    { key: 'debtPayment', name: 'üí≥ –ü–æ–≥–∞—à–µ–Ω–∏–µ –¥–æ–ª–≥–æ–≤', value: this.player.expenses.debtPayment }
                ];
                
                categories.forEach(cat => {
                    totalExpenses += cat.value;
                    html += `
                        <div class="budget-row">
                            <span>${cat.name}</span>
                            <span>${cat.value.toLocaleString()} ‚Ç∏</span>
                            <input type="range" 
                                   min="${cat.key === 'debtPayment' ? 0 : 200}"
                                   max="${cat.key === 'housing' ? 3500 : cat.key === 'food' ? 2500 : 1500}"
                                   value="${cat.value}"
                                   step="100"
                                   onchange="game.adjustExpense('${cat.key}', this.value)">
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                document.getElementById('total-income').textContent = `${this.player.income.toLocaleString()} ‚Ç∏`;
                document.getElementById('total-expenses').textContent = `${totalExpenses.toLocaleString()} ‚Ç∏`;
                document.getElementById('balance').textContent = `${(this.player.income - totalExpenses).toLocaleString()} ‚Ç∏`;
            }

            adjustExpense(category, value) {
                this.player.expenses[category] = parseInt(value);
                this.updateBudgetTable();
            }

            updatePhase(phase) {
                this.currentPhase = phase;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
                document.querySelectorAll('.phase').forEach(el => el.classList.remove('active'));
                document.getElementById(`phase-${phase}`).classList.add('active');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                const content = document.getElementById('phase-content');
                
                switch(phase) {
                    case 'income':
                        content.innerHTML = '<h4>üí∞ –î–æ—Ö–æ–¥—ã</h4><p>–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ—Ö–æ–¥: ' + this.player.income.toLocaleString() + ' ‚Ç∏</p>';
                        break;
                    case 'expenses':
                        content.innerHTML = '<h4>üìâ –†–∞—Å—Ö–æ–¥—ã</h4><p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±—é–¥–∂–µ—Ç –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–ª–µ–¥—É—é—â–∞—è —Ñ–∞–∑–∞"</p>';
                        break;
                    case 'event':
                        content.innerHTML = '<h4>üé≤ –°–æ–±—ã—Ç–∏–µ</h4><p>–°–º–æ—Ç—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É —Å–æ–±—ã—Ç–∏—è —Å–ø—Ä–∞–≤–∞</p>';
                        this.drawEvent();
                        break;
                    case 'decision':
                        content.innerHTML = '<h4>ü§î –†–µ—à–µ–Ω–∏–µ</h4>' +
                            '<div style="display: flex; gap: 0.5rem; margin-top: 1rem;">' +
                            '<button class="btn btn-outline" onclick="game.transferToSavings()">üè¶ –í —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è</button>' +
                            '<button class="btn btn-outline" onclick="game.showInvestModal()">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>' +
                            '<button class="btn btn-outline" onclick="game.takeLoan()">üí≥ –ö—Ä–µ–¥–∏—Ç</button>' +
                            '<button class="btn btn-outline" onclick="game.payDebt()">üìâ –ü–æ–≥–∞—Å–∏—Ç—å –¥–æ–ª–≥</button>' +
                            '</div>';
                        break;
                    case 'result':
                        const netWorth = this.calculateNetWorth();
                        content.innerHTML = '<h4>üìä –ò—Ç–æ–≥ —Ä–∞—É–Ω–¥–∞</h4>' +
                            '<p>–ß–∏—Å—Ç–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ' + netWorth.toLocaleString() + ' ‚Ç∏</p>';
                        break;
                }
            }

            nextPhase() {
                const phases = ['income', 'expenses', 'event', 'decision', 'result'];
                const currentIndex = phases.indexOf(this.currentPhase);
                
                if (currentIndex < phases.length - 1) {
                    this.updatePhase(phases[currentIndex + 1]);
                } else {
                    this.endRound();
                }
            }

            drawEvent() {
                if (Math.random() < 0.7) {
                    const randomIndex = Math.floor(Math.random() * EVENT_DECK.length);
                    this.currentEvent = { ...EVENT_DECK[randomIndex] };
                    
                    document.getElementById('event-title').textContent = this.currentEvent.text;
                    document.getElementById('event-description').textContent = this.currentEvent.description;
                    
                    const valueEl = document.getElementById('event-value');
                    valueEl.style.display = 'block';
                    valueEl.className = `event-value ${this.currentEvent.value > 0 ? 'positive' : 'negative'}`;
                    valueEl.textContent = `${this.currentEvent.value > 0 ? '+' : ''}${this.currentEvent.value.toLocaleString()} ‚Ç∏`;
                    
                    if (this.currentEvent.options) {
                        document.getElementById('event-actions').innerHTML = `
                            <button class="btn btn-primary" onclick="game.handleInvestment()">üí∞ –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-outline" onclick="game.skipEvent()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
                        `;
                    } else {
                        document.getElementById('event-actions').innerHTML = `
                            <button class="btn btn-primary" onclick="game.acceptEvent()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        `;
                    }
                } else {
                    document.getElementById('event-card').style.opacity = '0.5';
                    document.getElementById('event-title').textContent = '–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π';
                    document.getElementById('event-description').textContent = '–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –≤—Å—ë —Å–ø–æ–∫–æ–π–Ω–æ';
                    document.getElementById('event-value').style.display = 'none';
                    document.getElementById('event-actions').innerHTML = '';
                }
            }

            acceptEvent() {
                if (!this.currentEvent) return;
                
                if (this.currentEvent.type === 'crisis') {
                    this.player.income *= (1 + this.currentEvent.value);
                } else if (this.currentEvent.value) {
                    this.player.money += this.currentEvent.value;
                    if (this.player.money < 0) this.autoLoan();
                }
                
                this.currentEvent = null;
                this.updateUI();
                this.updateBudgetTable();
            }

            skipEvent() {
                this.currentEvent = null;
                document.getElementById('event-card').style.opacity = '1';
            }

            autoLoan() {
                const loanAmount = -this.player.money + 5000;
                this.player.money += loanAmount;
                this.player.debts += loanAmount * 1.15;
                this.player.expenses.debtPayment = this.player.debts * 0.15;
                alert(`üí≥ –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç: +${Math.round(loanAmount).toLocaleString()} ‚Ç∏`);
            }

            transferToSavings() {
                const amount = Math.min(this.player.money, 3000);
                if (amount > 0) {
                    this.player.money -= amount;
                    this.player.savings += amount;
                    this.updateUI();
                    alert(`üè¶ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è: ${amount.toLocaleString()} ‚Ç∏`);
                }
            }

            showInvestModal() {
                if (this.player.money < 5000) {
                    alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 5 000 ‚Ç∏');
                    return;
                }
                
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'invest-modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3>üìà –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</h3>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem; margin: 1rem 0;">
                            <button class="btn btn-outline" onclick="game.invest(5000, 0.08, 0.3)">üìä –ê–∫—Ü–∏–∏ (8% / —Ä–∏—Å–∫ 30%)</button>
                            <button class="btn btn-outline" onclick="game.invest(5000, 0.04, 0.05)">üìâ –û–±–ª–∏–≥–∞—Ü–∏–∏ (4% / —Ä–∏—Å–∫ 5%)</button>
                        </div>
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.remove()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            invest(amount, rate, risk) {
                if (this.player.money < amount) {
                    alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                    return;
                }
                
                this.player.money -= amount;
                this.player.investments += amount;
                
                document.getElementById('invest-modal')?.remove();
                alert(`‚úÖ –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${amount.toLocaleString()} ‚Ç∏`);
                this.updateUI();
            }

            takeLoan() {
                const amount = 10000;
                this.player.money += amount;
                this.player.debts += amount * 1.15;
                this.player.expenses.debtPayment = this.player.debts * 0.15;
                this.updateUI();
                this.updateBudgetTable();
                alert(`üí≥ –ö—Ä–µ–¥–∏—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω: ${amount.toLocaleString()} ‚Ç∏`);
            }

            payDebt() {
                if (this.player.debts <= 0) {
                    alert('‚úÖ –£ –≤–∞—Å –Ω–µ—Ç –¥–æ–ª–≥–æ–≤!');
                    return;
                }
                
                const maxPayment = Math.min(this.player.money, this.player.debts);
                if (maxPayment > 0) {
                    this.player.money -= maxPayment;
                    this.player.debts -= maxPayment;
                    this.player.expenses.debtPayment = this.player.debts * 0.15;
                    this.updateUI();
                    this.updateBudgetTable();
                    alert(`‚úÖ –î–æ–ª–≥ –ø–æ–≥–∞—à–µ–Ω: ${maxPayment.toLocaleString()} ‚Ç∏`);
                }
            }

            handleInvestment() {
                if (this.currentEvent && this.currentEvent.value < 0) {
                    const amount = Math.abs(this.currentEvent.value);
                    this.invest(amount, 0.08, 0.3);
                    this.currentEvent = null;
                    this.skipEvent();
                }
            }

            endRound() {
                if (this.currentRound >= this.settings.roundsCount) {
                    this.showFinalScreen();
                } else {
                    this.currentRound++;
                    this.updatePhase('income');
                    this.updateUI();
                    this.updateBudgetTable();
                }
            }

            showFinalScreen() {
                const netWorth = this.calculateNetWorth();
                const goalsCompleted = Object.values(this.player.goals).filter(g => g.completed).length;
                
                document.getElementById('final-networth').textContent = `${Math.round(netWorth).toLocaleString()} ‚Ç∏`;
                document.getElementById('final-goals').textContent = `${goalsCompleted}/4`;
                
                let rating = 'B';
                if (netWorth > 50000) rating = 'üü¢ A';
                else if (netWorth > 20000) rating = 'üü° B';
                else rating = 'üî¥ C';
                document.getElementById('final-rating').textContent = rating;
                
                this.showScreen('final-screen');
            }

            saveSettings() {
                this.settings = {
                    playersCount: parseInt(document.getElementById('players-count').value),
                    roundsCount: parseInt(document.getElementById('rounds-count').value),
                    difficulty: document.getElementById('difficulty-level').value
                };
                this.showScreen('main-menu');
            }

            saveGame() {
                const gameState = {
                    player: this.player,
                    currentRound: this.currentRound,
                    settings: this.settings
                };
                localStorage.setItem('familyBudgetSave', JSON.stringify(gameState));
                alert('üíæ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
            }

            loadGame() {
                const saved = localStorage.getItem('familyBudgetSave');
                if (saved) {
                    const state = JSON.parse(saved);
                    this.player = state.player;
                    this.currentRound = state.currentRound;
                    this.settings = state.settings;
                    
                    document.getElementById('max-rounds').textContent = `/${this.settings.roundsCount}`;
                    this.updateUI();
                    this.updateBudgetTable();
                    this.updatePhase('income');
                    this.showScreen('game-screen');
                }
            }
        }

        // ========== –ó–ê–ü–£–°–ö ==========
        let game;
        window.onload = function() {
            game = new FamilyBudgetGame();
            window.game = game; // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º –¥–ª—è onclick
        };
    </script>
</body>
</html>
